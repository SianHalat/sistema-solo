<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#050a15">
    <link rel="icon" type="image/png" href="icon.png">
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;600;700&family=Noto+Sans+JP&family=Noto+Sans+KR&family=Noto+Sans+SC&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #e6ffff;
            --neon-glow: 0 0 10px var(--neon-blue), 0 0 20px rgba(0, 200, 255, 0.5);
            --danger: #ff3333;
            --gold: #ffaa00;
            --bg-dark: #050a15;
            --font-main: 'Chakra Petch', sans-serif;
        }

        /* Suporte a fontes asi√°ticas */
        body.lang-cjk { font-family: 'Noto Sans JP', 'Noto Sans KR', 'Noto Sans SC', sans-serif !important; }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(0, 100, 255, 0.05) 0%, transparent 60%),
                repeating-linear-gradient(45deg, rgba(0, 200, 255, 0.02) 0px, rgba(0, 200, 255, 0.02) 1px, transparent 1px, transparent 10px);
            background-size: 100% 100%, 20px 20px;
            color: var(--neon-blue);
            font-family: var(--font-main);
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center; padding: 15px; padding-bottom: 90px;
            text-shadow: var(--neon-glow);
            overflow-x: hidden;
            transition: all 0.5s ease;
        }

        /* MODO EMERG√äNCIA (Texto Vermelho) */
        body.emergency {
            --neon-blue: #ff3333;
            --neon-glow: 0 0 10px red, 0 0 20px rgba(255, 0, 0, 0.5);
        }
        body.emergency .timer-display, body.emergency h1, body.emergency .nav-btn.active {
            color: red !important; text-shadow: 0 0 10px red; border-color: red;
        }

        /* UTILS */
        .icon { width: 28px; height: 28px; fill: var(--neon-blue); filter: drop-shadow(0 0 5px var(--neon-blue)); margin-right: 10px; }
        .icon-sm { width: 20px; height: 20px; margin-right: 5px; fill: var(--neon-blue); filter: drop-shadow(0 0 5px var(--neon-blue)); }
        
        /* FRAMES */
        .main-frame {
            width: 100%; max-width: 600px;
            border: 1px solid var(--neon-blue);
            box-shadow: var(--neon-glow), inset 0 0 20px rgba(0, 200, 255, 0.1);
            padding: 20px; margin-bottom: 15px;
            background: rgba(0, 10, 25, 0.85);
            backdrop-filter: blur(4px);
            position: relative;
        }
        /* Detalhes nos cantos do frame (est√©tica anime) */
        .main-frame::before { content: ''; position: absolute; top: -1px; left: -1px; width: 10px; height: 10px; border-top: 3px solid #fff; border-left: 3px solid #fff; }
        .main-frame::after { content: ''; position: absolute; bottom: -1px; right: -1px; width: 10px; height: 10px; border-bottom: 3px solid #fff; border-right: 3px solid #fff; }

        /* HEADER (LEVEL / JOB / TITLE) - Estilo Refer√™ncia Imagem 5 */
        .header-grid {
            display: grid; grid-template-columns: auto 1fr; gap: 20px; align-items: center;
            border-bottom: 1px solid rgba(0,234,255,0.3); padding-bottom: 15px; margin-bottom: 15px;
        }
        .level-box { text-align: center; }
        .lvl-num { font-size: 3.5rem; font-weight: 700; line-height: 1; text-shadow: 0 0 15px var(--neon-blue); }
        .lvl-label { font-size: 0.8rem; letter-spacing: 2px; }
        
        .info-box { display: flex; flex-direction: column; justify-content: center; gap: 5px; }
        .info-row { display: flex; align-items: baseline; }
        .info-label { font-size: 0.75rem; color: #aaa; margin-right: 10px; min-width: 40px; }
        .info-val { font-size: 1.1rem; font-weight: 600; text-transform: uppercase; }

        /* SE√á√ÉO BARRAS */
        .bars-section { display: grid; grid-template-columns: 1fr 1fr auto; gap: 15px; align-items: center; margin-bottom: 20px; }
        .bar-group { width: 100%; }
        .bar-frame { height: 8px; width: 100%; border: 1px solid var(--neon-blue); border-radius: 4px; padding: 1px; }
        .bar-fill { height: 100%; background: var(--neon-blue); width: 100%; box-shadow: 0 0 8px var(--neon-blue); transition: width 0.5s; }
        .bar-text { display: flex; justify-content: space-between; font-size: 0.7rem; margin-top: 2px; }
        .fatigue-box { text-align: center; } 

        /* SE√á√ÉO ATRIBUTOS */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px 20px; }
        .stat-item { display: flex; align-items: center; }
        .stat-icon { font-size: 1.2rem; margin-right: 8px; } /* Usando emoji/texto pra simplificar √≠cones complexos, ou svg inline */
        .stat-name { font-size: 1rem; font-weight: 600; margin-right: auto; }
        .stat-val { font-size: 1.4rem; font-weight: 700; }
        .plus-btn {
            background: var(--neon-blue); color: #000; border: none;
            width: 20px; height: 20px; font-weight: bold; margin-left: 10px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
        }

        /* SETTINGS & TIMER */
        .top-ui { position: absolute; top: 15px; right: 15px; display: flex; gap: 10px; z-index: 200; }
        .icon-btn { background: rgba(0,0,0,0.8); border: 1px solid var(--neon-blue); color: var(--neon-blue); padding: 5px; cursor: pointer; }
        
        .timer-display { font-size: 1rem; font-weight: bold; padding: 5px 10px; border: 1px solid var(--neon-blue); background: rgba(0,0,0,0.8); }

        /* MODAL */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 1000; display: none;
            justify-content: center; align-items: center; flex-direction: column;
        }
        .modal.open { display: flex; }
        .modal-box { 
            background: #05101a; border: 2px solid var(--neon-blue); padding: 30px; 
            width: 80%; max-width: 400px; text-align: center; box-shadow: var(--neon-glow);
        }
        select { background: #000; color: var(--neon-blue); border: 1px solid var(--neon-blue); padding: 10px; width: 100%; margin: 10px 0; font-family: inherit; }
        
        .danger-btn { border: 1px solid red; color: red; background: transparent; padding: 10px; margin-top: 20px; width: 100%; cursor: pointer; }

        /* NAV & SECTIONS */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(0, 5, 15, 0.95); border-top: 1px solid var(--neon-blue);
            display: flex; justify-content: space-around; padding: 15px 0; z-index: 100;
        }
        .nav-btn { background: none; border: none; color: #666; font-family: inherit; font-size: 0.9rem; font-weight: bold; transition: 0.3s; }
        .nav-btn.active { color: var(--neon-blue); text-shadow: 0 0 10px var(--neon-blue); transform: scale(1.1); }

        .content-section { display: none; width: 100%; }
        .content-section.active { display: block; animation: fadeUp 0.3s forwards; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* QUESTS */
        .quest-item { display: flex; justify-content: space-between; border-bottom: 1px solid #333; padding: 15px 0; align-items: center; }
        .quest-check { width: 25px; height: 25px; accent-color: var(--neon-blue); }

    </style>
</head>
<body>

    <div class="top-ui">
        <div id="daily-timer" class="timer-display">00:00:00</div>
        <button class="icon-btn" onclick="ui.toggleSettings()"‚öôÔ∏è</button>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-box">
            <h2 id="txt-settings">SETTINGS</h2>
            
            <label id="txt-lang" style="display:block; margin-top:15px; text-align:left;">LANGUAGE</label>
            <select id="lang-select" onchange="game.setLang(this.value)">
                <option value="en">English</option>
                <option value="pt">Portugu√™s</option>
                <option value="es">Espa√±ol</option>
                <option value="ja">Êó•Êú¨Ë™û (Japanese)</option>
                <option value="zh">‰∏≠Êñá (Chinese)</option>
                <option value="ko">ÌïúÍµ≠Ïñ¥ (Korean)</option>
            </select>

            <button class="danger-btn" onclick="game.hardReset()" id="txt-reset">RESET PROGRESS</button>
            <button class="icon-btn" style="width:100%; margin-top:10px; border-color:#555; color:#fff" onclick="ui.toggleSettings()">CLOSE</button>
        </div>
    </div>

    <div id="penalty-zone" class="modal" style="border: 4px solid red; background: rgba(20,0,0,0.95);">
        <h1 style="color: red; font-size: 2.5rem; text-shadow: 0 0 20px red; margin-bottom: 20px;">PENALTY ZONE</h1>
        <p style="color: #fff; text-align: center; margin-bottom: 30px;">DAILY QUEST FAILED.</p>
        <button onclick="game.usePotion()" class="icon-btn" style="border-color:red; color:red; width: 200px; margin-bottom: 10px;">USE RETURN STONE</button>
        <button onclick="game.clearPenalty()" class="icon-btn" style="border-color:#555; color:#555; width: 200px;">I DID THE PENALTY</button>
    </div>

    <div id="notification" style="position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.95); border:1px solid var(--neon-blue); padding:20px; display:none; z-index:2000;">MSG</div>

    <div id="tab-status" class="content-section active">
        <div class="main-frame">
            <h2 style="text-align: center; margin-bottom: 10px; letter-spacing: 3px; border-bottom: 1px solid #333; padding-bottom: 5px;">STATUS</h2>
            
            <div class="header-grid">
                <div class="level-box">
                    <div id="val-lvl" class="lvl-num">1</div>
                    <div class="lvl-label">LEVEL</div>
                </div>
                <div class="info-box">
                    <div class="info-row">
                        <span class="info-label">JOB:</span>
                        <span id="val-job" class="info-val">NONE</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">TITLE:</span>
                        <span id="val-title" class="info-val">NONE</span>
                    </div>
                </div>
            </div>

            <div class="bars-section">
                <div class="bar-group">
                    <div style="display:flex; align-items:center"><svg class="icon-sm" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg> HP</div>
                    <div class="bar-frame"><div class="bar-fill" style="width:100%"></div></div>
                    <div class="bar-text"><span>100/100</span></div>
                </div>
                <div class="bar-group">
                    <div style="display:flex; align-items:center"><svg class="icon-sm" viewBox="0 0 24 24"><path d="M13 3h-2v2h2V3zm4 4h-2v2h2V7zM9 7H7v2h2V7z"/></svg> MP</div>
                    <div class="bar-frame"><div class="bar-fill" style="width:100%"></div></div>
                    <div class="bar-text"><span>10/10</span></div>
                </div>
                <div class="fatigue-box">
                    <div style="font-size:0.7rem; color:#aaa">FATIGUE</div>
                    <div style="font-size:1.2rem; font-weight:bold">0</div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-icon">üí™</span>
                    <span class="stat-name">STR</span>
                    <span id="val-STR" class="stat-val">10</span>
                    <button class="plus-btn" onclick="game.addStat('STR')">+</button>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">‚ù§Ô∏è</span>
                    <span class="stat-name">VIT</span>
                    <span id="val-VIT" class="stat-val">10</span>
                    <button class="plus-btn" onclick="game.addStat('VIT')">+</button>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">‚ö°</span>
                    <span class="stat-name">AGI</span>
                    <span id="val-AGI" class="stat-val">10</span>
                    <button class="plus-btn" onclick="game.addStat('AGI')">+</button>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üß†</span>
                    <span class="stat-name">INT</span>
                    <span id="val-INT" class="stat-val">10</span>
                    <button class="plus-btn" onclick="game.addStat('INT')">+</button>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üëÅÔ∏è</span>
                    <span class="stat-name">PER</span>
                    <span id="val-PER" class="stat-val">10</span>
                    <button class="plus-btn" onclick="game.addStat('PER')">+</button>
                </div>
            </div>

            <div style="margin-top:20px; text-align:right; border-top:1px solid #333; padding-top:10px;">
                <span id="txt-pts">Available Ability Points:</span> 
                <span id="val-pts" style="font-size:1.5rem; font-weight:700; margin-left:10px;">0</span>
            </div>
            <div style="text-align:right; font-size:0.8rem; color:var(--gold)">
                GOLD: <span id="val-gold">0</span> | XP: <span id="val-xp">0/100</span>
            </div>
        </div>
    </div>

    <div id="tab-quests" class="content-section">
        <div class="main-frame">
            <h2 id="txt-quests-title" style="text-align: center; margin-bottom: 20px;">DAILY QUESTS</h2>
            <div id="quest-list"></div>
            <button id="btn-finish" onclick="game.finishDay()" style="width:100%; padding:15px; margin-top:20px; background:rgba(0,200,255,0.1); border:1px solid var(--neon-blue); color:var(--neon-blue); font-weight:bold; cursor:pointer;">[ CLAIM REWARDS ]</button>
        </div>
    </div>

    <div id="tab-shop" class="content-section">
        <div class="main-frame">
            <h2 style="text-align:center; color:var(--gold)">SHOP</h2>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:15px;">
                <div class="shop-item" style="border:1px solid var(--neon-blue); padding:10px; text-align:center;" onclick="game.buy('Return Stone', 200)">
                    <div style="font-size:0.8rem">RETURN STONE</div>
                    <div style="color:var(--gold)">200 G</div>
                </div>
                <div class="shop-item" style="border:1px solid var(--neon-blue); padding:10px; text-align:center;" onclick="game.buy('Potion', 100)">
                    <div style="font-size:0.8rem">POTION</div>
                    <div style="color:var(--gold)">100 G</div>
                </div>
            </div>
            <h3 style="margin-top:20px; border-bottom:1px solid #333;">INVENTORY</h3>
            <div id="inv-list" style="padding:10px; font-size:0.8rem;">Empty</div>
        </div>
    </div>

    <nav class="nav-bar">
        <button class="nav-btn active" onclick="ui.tab('status')" id="nav-status">STATUS</button>
        <button class="nav-btn" onclick="ui.tab('quests')" id="nav-quests">QUESTS</button>
        <button class="nav-btn" onclick="ui.tab('shop')" id="nav-shop">SHOP</button>
    </nav>

    <script>
        const translations = {
            en: { status: "STATUS", quests: "QUESTS", shop: "SHOP", job: "JOB:", title: "TITLE:", pts: "Available Ability Points:", settings: "SETTINGS", lang: "LANGUAGE", reset: "RESET PROGRESS (DANGER)", finish: "[ CLAIM REWARDS / FINISH ]", q_push: "PUSH-UPS", q_sit: "SIT-UPS", q_squat: "SQUATS", q_run: "RUNNING", q_study: "STUDY", none: "NONE", job_necro: "NECROMANCER", job_monarch: "SHADOW MONARCH", t_wolf: "WOLF ASSASSIN", t_adversity: "ONE WHO OVERCAME ADVERSITY", t_demon: "DEMON HUNTER" },
            pt: { status: "STATUS", quests: "MISS√ïES", shop: "LOJA", job: "CLASSE:", title: "T√çTULO:", pts: "Pontos Dispon√≠veis:", settings: "CONFIGURA√á√ïES", lang: "IDIOMA", reset: "RESETAR PROGRESSO", finish: "[ RECEBER / FINALIZAR ]", q_push: "FLEX√ïES", q_sit: "ABDOMINAIS", q_squat: "AGACHAMENTOS", q_run: "CORRIDA", q_study: "ESTUDAR", none: "NENHUM", job_necro: "NECROMANTE", job_monarch: "MONARCA DAS SOMBRAS", t_wolf: "ASSASSINO DE LOBOS", t_adversity: "AQUELE QUE SUPEROU A ADVERSIDADE", t_demon: "CA√áADOR DE DEM√îNIOS" },
            es: { status: "ESTADO", quests: "MISIONES", shop: "TIENDA", job: "CLASE:", title: "T√çTULO:", pts: "Puntos Disponibles:", settings: "AJUSTES", lang: "IDIOMA", reset: "REINICIAR PROGRESO", finish: "[ RECLAMAR / FINALIZAR ]", q_push: "FLEXIONES", q_sit: "ABDOMINALES", q_squat: "SENTADILLAS", q_run: "CORRER", q_study: "ESTUDIAR", none: "NINGUNO", job_necro: "NECROMANTE", job_monarch: "MONARCA DE LAS SOMBRAS", t_wolf: "ASESINO DE LOBOS", t_adversity: "SUPERADOR DE ADVERSIDAD", t_demon: "CAZADOR DE DEMONIOS" },
            ja: { status: "„Çπ„ÉÜ„Éº„Çø„Çπ", quests: "„ÇØ„Ç®„Çπ„Éà", shop: "„Ç∑„Éß„ÉÉ„Éó", job: "ËÅ∑Ê•≠:", title: "Áß∞Âè∑:", pts: "Âà©Áî®ÂèØËÉΩ„Å™ËÉΩÂäõ„Éù„Ç§„É≥„Éà:", settings: "Ë®≠ÂÆö", lang: "Ë®ÄË™û", reset: "ÈÄ≤Ë°åÁä∂Ê≥Å„Çí„É™„Çª„ÉÉ„Éà", finish: "[ Â†±ÈÖ¨„ÇíÂèó„ÅëÂèñ„Çã ]", q_push: "ËÖïÁ´ã„Å¶‰ºè„Åõ", q_sit: "ËÖπÁ≠ã", q_squat: "„Çπ„ÇØ„ÉØ„ÉÉ„Éà", q_run: "„É©„É≥„Éã„É≥„Ç∞", q_study: "ÂãâÂº∑", none: "„Å™„Åó", job_necro: "„Éç„ÇØ„É≠„Éû„É≥„Çµ„Éº", job_monarch: "ÂΩ±„ÅÆÂêõ‰∏ª", t_wolf: "ÁãºÊÆ∫„Åó", t_adversity: "ÈÄÜÂ¢É„Çí‰πó„ÇäË∂ä„Åà„ÅóËÄÖ", t_demon: "ÊÇ™È≠îÁã©„Çä" },
            ko: { status: "ÏÉÅÌÉú", quests: "ÌÄòÏä§Ìä∏", shop: "ÏÉÅÏ†ê", job: "ÏßÅÏóÖ:", title: "Ïπ≠Ìò∏:", pts: "ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Îä•Î†•Ïπò Ìè¨Ïù∏Ìä∏:", settings: "ÏÑ§Ï†ï", lang: "Ïñ∏Ïñ¥", reset: "ÏßÑÌñâ Ï¥àÍ∏∞Ìôî", finish: "[ Î≥¥ÏÉÅ Î∞õÍ∏∞ ]", q_push: "ÌåîÍµΩÌòÄÌé¥Í∏∞", q_sit: "ÏúóÎ™∏ÏùºÏúºÌÇ§Í∏∞", q_squat: "Ïä§ÏøºÌä∏", q_run: "Îã¨Î¶¨Í∏∞", q_study: "Í≥µÎ∂Ä", none: "ÏóÜÏùå", job_necro: "ÎÑ§ÌÅ¨Î°úÎß®ÏÑú", job_monarch: "Í∑∏Î¶ºÏûê Íµ∞Ï£º", t_wolf: "ÎäëÎåÄ ÌïôÏÇ¥Ïûê", t_adversity: "Ïó≠Í≤ΩÏùÑ Ïù¥Í≤®ÎÇ∏ Ïûê", t_demon: "ÏïÖÎßà ÏÇ¨ÎÉ•Íæº" },
            zh: { status: "Áä∂ÊÄÅ", quests: "‰ªªÂä°", shop: "ÂïÜÂ∫ó", job: "ËÅå‰∏ö:", title: "Áß∞Âè∑:", pts: "ÂèØÁî®ËÉΩÂäõÁÇπ:", settings: "ËÆæÁΩÆ", lang: "ËØ≠Ë®Ä", reset: "ÈáçÁΩÆËøõÂ∫¶", finish: "[ È¢ÜÂèñÂ•ñÂä± ]", q_push: "‰øØÂçßÊíë", q_sit: "‰ª∞ÂçßËµ∑Âùê", q_squat: "Ê∑±Ëπ≤", q_run: "Ë∑ëÊ≠•", q_study: "Â≠¶‰π†", none: "Êó†", job_necro: "‰∫°ÁÅµÊ≥ïÂ∏à", job_monarch: "ÊöóÂΩ±Âêõ‰∏ª", t_wolf: "ÁãºÊóèÊùÄÊâã", t_adversity: "ÊàòËÉúÈÄÜÂ¢ÉËÄÖ", t_demon: "ÊÅ∂È≠îÁåéÊâã" }
        };

        const game = {
            data: {
                stats: { STR: 10, VIT: 10, AGI: 10, INT: 10, PER: 10 },
                pts: 3, xp: 0, xpMax: 100, gold: 0, lvl: 1,
                job: 'none', title: 'none',
                lang: 'en',
                lastLogin: null,
                quests: [
                    { id: 'q_push', count: 100, done: false, xp: 20, gold: 10 },
                    { id: 'q_sit', count: 100, done: false, xp: 20, gold: 10 },
                    { id: 'q_squat', count: 100, done: false, xp: 20, gold: 10 },
                    { id: 'q_run', count: '10KM', done: false, xp: 30, gold: 20 },
                    { id: 'q_study', count: '30m', done: false, xp: 15, gold: 5 }
                ],
                inventory: []
            },
            
            init() {
                const save = localStorage.getItem('sl_sys_v6');
                if(save) this.data = JSON.parse(save);
                
                // Set language selector
                document.getElementById('lang-select').value = this.data.lang;
                if(['ja', 'zh', 'ko'].includes(this.data.lang)) document.body.classList.add('lang-cjk');

                // Day Reset Logic
                const today = new Date().toDateString();
                if(this.data.lastLogin !== today) {
                    this.data.quests.forEach(q => q.done = false);
                    this.data.lastLogin = today;
                    this.save();
                }

                this.updateProfile(); // Check Job/Titles
                ui.render();
                setInterval(this.clockLoop, 1000);
            },

            save() { localStorage.setItem('sl_sys_v6', JSON.stringify(this.data)); },

            setLang(l) {
                this.data.lang = l;
                if(['ja', 'zh', 'ko'].includes(l)) document.body.classList.add('lang-cjk');
                else document.body.classList.remove('lang-cjk');
                this.save();
                ui.render();
            },

            hardReset() {
                if(confirm("ARE YOU SURE? THIS WILL DELETE EVERYTHING.")) {
                    localStorage.removeItem('sl_sys_v6');
                    location.reload();
                }
            },

            updateProfile() {
                // Progression Logic based on Solo Leveling Canon
                const l = this.data.lvl;
                
                // JOBS
                if (l < 40) this.data.job = 'none';
                else if (l < 45) this.data.job = 'job_necro'; // Level 40 Job Change Quest
                else this.data.job = 'job_monarch'; // Immediate promotion

                // TITLES
                if (l < 10) this.data.title = 'none';
                else if (l < 25) this.data.title = 't_wolf'; // Wolf Assassin (Early game)
                else if (l < 50) this.data.title = 't_adversity'; // Red Gate Arc
                else this.data.title = 't_demon'; // Demon Castle Arc
            },

            clockLoop() {
                const now = new Date();
                const end = new Date(); end.setHours(23, 59, 59);
                const diff = end - now;
                const h = Math.floor(diff/(1000*60*60));
                const m = Math.floor((diff%(1000*60*60))/(1000*60));
                const s = Math.floor((diff%(1000*60))/1000);
                
                const timerEl = document.getElementById('daily-timer');
                timerEl.innerText = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
                
                // Emergency Mode (Less than 3 hours)
                if(h < 3) document.body.classList.add('emergency');
                else document.body.classList.remove('emergency');
            },

            addStat(key) {
                if(this.data.pts > 0) {
                    this.data.stats[key]++;
                    this.data.pts--;
                    this.save(); ui.render();
                }
            },

            toggleQuest(idx) {
                const q = this.data.quests[idx];
                if(q.done) return;
                
                q.done = true;
                this.data.xp += q.xp;
                this.data.gold += q.gold;
                
                if(this.data.xp >= this.data.xpMax) {
                    this.data.xp -= this.data.xpMax;
                    this.data.lvl++;
                    this.data.xpMax = Math.floor(this.data.xpMax * 1.2);
                    this.data.pts += 3;
                    this.updateProfile();
                    ui.notify("LEVEL UP!");
                }
                this.save(); ui.render();
            },

            finishDay() {
                if(this.data.quests.every(q => q.done)) {
                    ui.notify("QUESTS COMPLETED");
                } else {
                    document.getElementById('penalty-zone').style.display = 'flex';
                }
            },

            buy(name, cost) {
                if(this.data.gold >= cost) {
                    this.data.gold -= cost;
                    this.data.inventory.push(name);
                    ui.notify("BOUGHT: " + name);
                    this.save(); ui.render();
                } else ui.notify("NO GOLD");
            },

            usePotion() {
                const idx = this.data.inventory.indexOf('Return Stone');
                if(idx > -1) {
                    this.data.inventory.splice(idx, 1);
                    document.getElementById('penalty-zone').style.display = 'none';
                    ui.notify("PENALTY CLEARED");
                    this.save(); ui.render();
                } else ui.notify("NO ITEM");
            },
            clearPenalty() {
                if(confirm("Confirm?")) document.getElementById('penalty-zone').style.display = 'none';
            }
        };

        const ui = {
            toggleSettings: () => {
                const el = document.getElementById('settings-modal');
                el.classList.toggle('open');
            },

            tab(name) {
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                document.getElementById('tab-'+name).classList.add('active');
                document.getElementById('nav-'+name).classList.add('active');
            },

            render() {
                const d = game.data;
                const t = translations[d.lang] || translations['en'];

                // Translate Static Text
                document.getElementById('nav-status').innerText = t.status;
                document.getElementById('nav-quests').innerText = t.quests;
                document.getElementById('nav-shop').innerText = t.shop;
                document.getElementById('txt-pts').innerText = t.pts;
                document.getElementById('txt-settings').innerText = t.settings;
                document.getElementById('txt-lang').innerText = t.lang;
                document.getElementById('txt-reset').innerText = t.reset;
                document.getElementById('txt-quests-title').innerText = t.quests;
                document.getElementById('btn-finish').innerText = t.finish;

                // Profile
                document.getElementById('val-lvl').innerText = d.lvl;
                document.getElementById('val-job').innerText = t[d.job];
                document.getElementById('val-title').innerText = t[d.title];
                
                // Stats
                for(let key in d.stats) document.getElementById('val-'+key).innerText = d.stats[key];
                document.getElementById('val-pts').innerText = d.pts;
                document.getElementById('val-gold').innerText = d.gold;
                document.getElementById('val-xp').innerText = `${d.xp}/${d.xpMax}`;

                document.querySelectorAll('.plus-btn').forEach(b => b.style.display = d.pts > 0 ? 'flex' : 'none');

                // Quests
                const qList = document.getElementById('quest-list');
                qList.innerHTML = '';
                d.quests.forEach((q, i) => {
                    const qName = t[q.id] || q.id;
                    qList.innerHTML += `
                        <div class="quest-item" style="${q.done ? 'opacity:0.5' : ''}">
                            <div style="${q.done ? 'text-decoration:line-through' : ''}; font-weight:600">
                                ${qName} <span style="color:#aaa; font-size:0.8rem">[${q.count}]</span>
                            </div>
                            <input type="checkbox" class="quest-check" ${q.done ? 'checked disabled' : ''} onchange="game.toggleQuest(${i})">
                        </div>
                    `;
                });

                // Inventory
                const inv = document.getElementById('inv-list');
                inv.innerHTML = d.inventory.length ? d.inventory.map(i => `<div>${i}</div>`).join('') : 'Empty';
            },

            notify(msg) {
                const n = document.getElementById('notification');
                n.innerText = msg; n.style.display='block';
                setTimeout(()=>n.style.display='none', 2000);
            }
        };

        game.init();
        if('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
    </script>
</body>
</html>